nodejs
csv to mysql db

ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ
1. 실패


// Importing mysql and csvtojson packages
// Requiring module
const csvtojson = require('csvtojson');
const mysql = require("mysql");

// Database credentials
const hostname = "localhost",
	username = "root",
	password = "1234",
	databsename = "teamproject"


// Establish connection to the database
let con = mysql.createConnection({
	host: hostname,
	user: username,
	password: password,
	database: databsename,
});

con.connect((err) => {
	if (err) return console.error(
			'error: ' + err.message);

	con.query("DROP TABLE sample",
		(err, drop) => {

		// Query to create table "sample"
		var createStatament =
		"CREATE TABLE location(l_id int, name varchar(40), phone varchar(20)," +
		"latitude varchar(50), longtitude varchar(50), address varchar(255))"
        

		// Creating table "sample"
		con.query(createStatament, (err, drop) => {
			if (err)
				console.log("ERROR: ", err);
		});
	});
});

// CSV file name
const fileName = "golf.csv";

csvtojson().fromFile(fileName).then(source => {

	// Fetching the data from each row
	// and inserting to the table "sample"
	for (var i = 0; i < source.length; i++) {
		var 
            l_id = source[i]["번호"],
            Name = source[i]["사업자명"],
			phone = source[i]["소재지전화"],
			latitude = source[i]["Age"],
			longtitude = source[i]["City"],
            address = source[i]["소재지전체주소"]

		var insertStatement =
		`INSERT INTO sample values(?, ?, ?, ?, ?, ?)`;
		var items = [l_id, Name, phone, latitude, longtitude, address];

		// Inserting data of current row
		// into database
		con.query(insertStatement, items,
			(err, results, fields) => {
			if (err) {
				console.log(
	"Unable to insert item at row ", i + 1);
				return console.log(err);
			}
		});
	}
	console.log(
"All items stored into database successfully");
});



ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ
2.성공했지만 보충해야함

const fs = require("fs");
const mysql = require("mysql");
const fastcsv = require("fast-csv");

let stream = fs.createReadStream("golf.csv");
let csvData = [];
let csvStream = fastcsv
  .parse()
  .on("data", function(data) {
    csvData.push(data);
  })
  .on("end", function() {
    // remove the first line: header
    csvData.shift();

    // create a new connection to the database
    const connection = mysql.createConnection({
        host: "localhost",
        user: "root",
        password: "12341234",
        database: "teamproject"
    });

    // open the connection
    connection.connect(error => {
      if (error) {
        console.error(error);
      } else {
        let query =
          "INSERT INTO location (l_id, address, latitude, longtitude, name, phone) VALUES ?";
        connection.query(query, [csvData], (error, response) => {
          console.log(error || response);
        });
      }
    });
  });

stream.pipe(csvStream);


ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ
3. 실패


const fs = require("fs");
const mysql = require("mysql");
const fastcsv = require("fast-csv");
const path = require("path");
const FILE_NAME = "golf.csv";

const csvPath = path.join(__dirname,'..','csvs', FILE_NAME);
const csv = fs.readFileSync(csvPath, "utf-8");
const rows = csv.split("\r\n")
if(rows[rows.length - 1] === '') {
    console.log("'' has been found");
    rows.pop();
}
console.log(rows)

let results = []
let columnTitle = []
for (const i in rows){
    const row = rows[i]
    const data = row.split(",")
    if (i==="0") {
        columnTitle = data
    } else {
        let row_data = {}
        for (const index in columnTitle) {
            const title = columnTitle[index]
            row_data[title] = data[index]
        }
        results.push(row_data)
    }
}
console.log(results)

